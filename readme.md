# 算法名称

云系统供暖季日内优化调度算法

# 1. 算法机理说明

根据日内预测的光伏出力、电热负荷，根据日内优化模型得到日内1h供热策略

# 2. 算法输入

|          **输入字段**          |            标识            |               描述               |  单位  |   类型   | **时间周期** | **数据粒度** | 取值范围 | 默认值 | 备注 |
| :----------------------------------: | :------------------------: | :------------------------------: | :-----: | :-------: | :----------------: | :----------------: | :-------: | :----: | :--: |
|       **电负荷预测数据**       | `powerLoadPrediction24h` |       24h的电负荷预测数据       | $kWh$ | `Float` |      全天24h      |       `1h`       | (0,10000) |        |      |
|    **光伏发电功率预测数据**    |    `pvPrediction24h`    |      24h的光伏发电功率数据      | $kW$ | `Float` |      全天24h      |       `1h`       | (0,10000) |        |      |
|     **当日地热井换热功率**     |        `Gghe24h`        |     24h地热井换热功率实时值     | $kW$ | `Float` |      全天24h      |       `1h`       | (0,10000) |        |      |
|     **当日地热井出水温度**     |     `GgheTempOut24h`     |     24h地热井出水温度实时值     | $℃$ | `Float` |      全天24h      |       `1h`       |  (0,100)  |        |      |
|      **室外温度预测数据**      |  `airtempPrediction24h`  |      24h的室外温度预测数据      | $℃$ | `Float` |      全天24h      |       `1h`       |  (0,100)  |        |      |
| **当前空气源热泵故障状态数据** |        `ahpState`        | 暖通系统的当前空气源热泵故障状态 |   $ $   |  `Int`  |      实时数据      |       `1h`       |  {0，1}  |    0    |   0：无故障；1：有故障   |
|    **当前锅炉1故障状态数据**    |        `eb1State`        |    暖通系统的当前锅炉1故障状态    |   $ $   |  `Int`  |      实时数据      |       `1h`       |  {0，1}  |    0    |   0：无故障；1：有故障   |
|    **当前锅炉2故障状态数据**    |        `eb2State`        |    暖通系统的当前锅炉2故障状态    |   $ $   |  `Int`  |      实时数据      |       `1h`       |  {0，1}  |    0    |   0：无故障；1：有故障   |
|  **当前地源热泵故障状态数据**  |        `ghpState`        |  暖通系统的当前地源热泵故障状态  |   $ $   |  `Int`  |      实时数据      |       `1h`       |  {0，1}  |    0    |   0：无故障；1：有故障   |

# 3. 算法输出

|          **输出字段**          |          标识          |                   描述                   |  单位  |    类型    | **时间周期** | **数据粒度** |             取值范围             | 默认值 |                       备注                       |
| :----------------------------------: | :---------------------: | :---------------------------------------: | :----: | :--------: | :----------------: | :----------------: | :-------------------------------: | :-----: | :-----------------------------------------------: |
|   **日前空气源热泵数量启停**   |  `ahpNumOpenStateDh`  | 日前24h策略中每小时空气源热泵数量启停状态 |  $ $  |  `int`  |      全天24h      |       `1h`       | {0,2,7,9} | 0 |         分别代表空气源热泵4种数量启停方式         |
|        **日前PVT启停**        |   `pvtOpenStateDh`   |      日前24h策略中每小时PVT启停状态      |  $ $  | `Int` |      全天24h      |       `1h`       |        {0，1}        | 1 |   0代表pvt的停决策，1代表pvt的启动决策   |
|       **日前电锅炉启停**       |    `ebOpenStateDh`    |       日前24h每小时电锅炉的启停状态       |  $ $  | `Int` |      全天24h      |       `1h`       |         {0，1}         | 0 | 0代表电锅炉的停决策，1代表电锅炉的启动决策 |
| **日前电锅炉给地热井灌热功率** | `ebExchangeChStateDh` |    日前24h每小时电锅炉给地热井灌热功率    | $kW$ | `float` |      全天24h      |       `1h`       |             (0,10000)             |        |                                                  |
|      **日前优化故障标志**      |    `errorStateDh`    |       日前24h优化算法求解中故障标志       |  $ $  |  `Int`  |      当前小时      |       `1h`       |             (0,1000)             |   100   | 100：正常求解；101：输入数据缺失；201：模型不可行 |

# 4. 输入输出示例

1. 输入：

```json
{
  "input": [
          {
              "key": "powerLoadPrediction24h",
              "type": "timeseries",
              "time": [1717171200000, 1717171203600, 1717171207200, 1717171210800, 1717171214400,
                        1717171218000, 1717171221600, 1717171225200, 1717171228800, 1717171232400,
                        1717171236000, 1717171239600, 1717171243200, 1717171246800, 1717171250400,
                        1717171254000, 1717171257600, 1717171261200, 1717171264800, 1717171268400,
                        1717171272000, 1717171275600, 1717171279200, 1717171282800],
              "value": [0.0, 0.0, 0.0, 0.0,  0.0, 0.0, 0.0, 0.0, 20.1, 20, 12.4, 15.6, 16.7,
                        15.8, 13.5, 9.5, 3.1, 4.2, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
          },
          {
              "key": "pvPrediction24h",
              "type": "timeseries",
              "time": [1717171200000, 1717171203600, 1717171207200, 1717171210800, 1717171214400,
                        1717171218000, 1717171221600, 1717171225200, 1717171228800, 1717171232400,
                        1717171236000, 1717171239600, 1717171243200, 1717171246800, 1717171250400,
                        1717171254000, 1717171257600, 1717171261200, 1717171264800, 1717171268400,
                        1717171272000, 1717171275600, 1717171279200, 1717171282800],
              "value": [0.0, 0.0, 0.0, 0.0,  0.0, 0.0, 0.0, 0.0, 254.1, 800.1, 1289.4, 1545.6, 1631.7,
                        1570.8, 1354.5, 955.5, 338.1, 4.2, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
          },
          {
              "key": "Gghe24h",
              "type": "timeseries",
              "time": [1717171200000, 1717171203600, 1717171207200, 1717171210800, 1717171214400,
                        1717171218000, 1717171221600, 1717171225200, 1717171228800, 1717171232400,
                        1717171236000, 1717171239600, 1717171243200, 1717171246800, 1717171250400,
                        1717171254000, 1717171257600, 1717171261200, 1717171264800, 1717171268400,
                        1717171272000, 1717171275600, 1717171279200, 1717171282800],
              "value": [1727.3009810217134, 1889.5732970714423, 2043.4474692086098, 2148.17864160415,
                        2210.2761869136607, 2232.214149767233, 2244.6787186528695, 2268.6907049951055,
                        2507.8103637829167, 2250.3145879843746, 2213.9857173013925, 2113.0133544359846,
                        1965.9622106843633, 1842.2901879461683, 1773.4785260746758, 1579.8594727905627,
                        1681.9469756477154, 1769.9375096802316, 1805.3167616814753, 1875.1292172285546,
                        1956.3339572524874, 1820.9536935007184, 1808.5752084450105, 1820.7245784535744]
          },
          {
              "key": "GgheTempOut24h",
              "type": "timeseries",
              "time": [1717171200000, 1717171203600, 1717171207200, 1717171210800, 1717171214400,
                        1717171218000, 1717171221600, 1717171225200, 1717171228800, 1717171232400,
                        1717171236000, 1717171239600, 1717171243200, 1717171246800, 1717171250400,
                        1717171254000, 1717171257600, 1717171261200, 1717171264800, 1717171268400,
                        1717171272000, 1717171275600, 1717171279200, 1717171282800],
              "value": [3.0, 4.0, 5.0, 6.0,  7.0, 8.0, 9.0, 10.0, 11.1, 12.1, 13.4, 15.6, 16.7,
                        15.8, 13.5, 9.5, 5.1, 4.2, 3.0, 3.0, 3.0, 2.0, 2.0, 2.0]
          },
          {
              "key": "airtempPrediction24h",
              "type": "timeseries",
              "time": [1717171200000, 1717171203600, 1717171207200, 1717171210800, 1717171214400,
                        1717171218000, 1717171221600, 1717171225200, 1717171228800, 1717171232400,
                        1717171236000, 1717171239600, 1717171243200, 1717171246800, 1717171250400,
                        1717171254000, 1717171257600, 1717171261200, 1717171264800, 1717171268400,
                        1717171272000, 1717171275600, 1717171279200, 1717171282800],
              "value": [3.0, 4.0, 5.0, 6.0,  7.0, 8.0, 9.0, 10.0, 11.1, 12.1, 13.4, 15.6, 16.7,
                        15.8, 13.5, 9.5, 5.1, 4.2, 3.0, 3.0, 3.0, 2.0, 2.0, 2.0]
          },
          {
              "key": "ahpState",
              "type": "timeseries",
              "time": [1717171200000],
              "value": [0]
          },
          {
              "key": "eb1State",
              "type": "timeseries",
              "time": [1717171200000],
              "value": [0]
          },
          {
              "key": "eb2State",
              "type": "timeseries",
              "time": [1717171200000],
              "value": [0]
          },
          {
              "key": "ghpState",
              "type": "timeseries",
              "time": [1717171200000],
              "value": [0]
          }
  ]
}
   
```

2. 输出：

```json
{
  "output": [
    {
      "key": "ahpNumOpenStateDh",
      "type": "timeseries",
      "time": [1717171200000, 1717171500000, 1717171800000, 1717172100000, 1717172400000, 1717172700000, 1717173000000, 1717173300000, 1717173600000, 1717173900000, 1717174200000, 1717174500000, 1717174800000, 1717175100000, 1717175400000, 1717175700000, 1717176000000, 1717176300000, 1717176600000, 1717176900000, 1717177200000, 1717177500000, 1717177800000, 1717178100000,],
      "value": ["ahp-0","ahp-0""ahp-0""ahp-0""ahp-0""ahp-0""ahp-0""ahp-0""ahp-0""ahp-4""ahp-5""ahp-9""ahp-5""ahp-4""ahp-0""ahp-0""ahp-0""ahp-0""ahp-0""ahp-0""ahp-0""ahp-0""ahp-0""ahp-0"]
    },
    {
      "key": "pvtOpenStateDh",
      "type": "timeseries",
      "time": [1717171200000, 1717171500000, 1717171800000, 1717172100000, 1717172400000, 1717172700000, 1717173000000, 1717173300000, 1717173600000, 1717173900000, 1717174200000, 1717174500000, 1717174800000, 1717175100000, 1717175400000, 1717175700000, 1717176000000, 1717176300000, 1717176600000, 1717176900000, 1717177200000, 1717177500000, 1717177800000, 1717178100000,],
      "value": ["pvt-1", "pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1","pvt-1",
      "pvt-1","pvt-1","pvt-1","pvt-1"]
    },
    {
      "key": "ebOpenStateDh",
      "type": "timeseries",
      "time": [1717171200000, 1717171500000, 1717171800000, 1717172100000, 1717172400000, 1717172700000, 1717173000000, 1717173300000, 1717173600000, 1717173900000, 1717174200000, 1717174500000, 1717174800000, 1717175100000, 1717175400000, 1717175700000, 1717176000000, 1717176300000, 1717176600000, 1717176900000, 1717177200000, 1717177500000, 1717177800000, 1717178100000,],
      "value": ["eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0","eb-0"]
    },
    {
      "key": "ebExchangeChStateDh",
      "type": "timeseries",
      "time": [1717171200000, 1717171500000, 1717171800000, 1717172100000, 1717172400000, 1717172700000, 1717173000000, 1717173300000, 1717173600000, 1717173900000, 1717174200000, 1717174500000, 1717174800000, 1717175100000, 1717175400000, 1717175700000, 1717176000000, 1717176300000, 1717176600000, 1717176900000, 1717177200000, 1717177500000, 1717177800000, 1717178100000,],
      "value": [60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60]
    },
    {
      "key": "errorStateDh",
      "type": "timeseries",
      "time": [1717171200000],
      "value": [100]
    },
  ]
}
  
```

# 5. 配置项

无

# 6. 异常处理

1. 数据库为空，不处理，直接返回
2. 存在缺失值，差值补全
3. 算法运行失败，返回错误代码

# 7. 算法依赖包

1. `scipy`
2. `numpy`
3. `random`
4. `pyscipopt`
5. `json`
